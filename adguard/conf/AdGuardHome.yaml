# ============ FILE: adguard/conf/AdGuardHome.yaml ============

# Main AdGuard Home configuration for the web UI
# Caddy will reverse proxy to this plain HTTP port
bind_host: 0.0.0.0 # Crucial: Listen on all interfaces so Caddy can reach it
port: 3000 # <--- Explicit plain HTTP port for the AdGuard Home web UI

# --- TLS Configuration for AdGuard Home ---
# IMPORTANT: Set to false if Caddy is handling TLS termination for the UI and DoH.
tls:
  enabled: false # <--- CHANGE THIS TO FALSE!
  # The following settings become irrelevant for services proxied by Caddy when enabled: false
  server_name: ""
  force_https: false
  port_https: 443
  port_dns_over_tls: 853
  port_dns_over_quic: 853
  port_dnscrypt: 0
  dnscrypt_config_file: ""
  allow_unencrypted_doh: true # This setting is now harmless/irrelevant here
  certificate_chain: ""
  private_key: ""
  certificate_path: ""
  private_key_path: ""
  strict_sni_check: false

# --- DNS Configuration ---
dns:
  bind_hosts:
    - 0.0.0.0
  port: 53 # Traditional DNS listener (maps to 5300 on host)
  anonymize_client_ip: false
  ratelimit: 20
  ratelimit_subnet_len_ipv4: 24
  ratelimit_subnet_len_ipv6: 56
  ratelimit_whitelist: []
  refuse_any: true
  upstream_dns: []
  upstream_dns_file: ""
  bootstrap_dns: []
  fallback_dns: []
  upstream_mode: load_balance
  fastest_timeout: 1s
  allowed_clients: []
  disallowed_clients: []
  blocked_hosts: []
  trusted_proxies:
    - 127.0.0.0/8
    - ::1/128
  cache_enabled: true
  cache_size: 4194304
  cache_ttl_min: 0

  # Define the HTTP (plain text) DoH server here
  # Caddy will connect to this port over HTTP
  upstream_dns_json_server:
    - bind_host: 0.0.0.0 # Crucial: Listen on all interfaces
      port: 8443 # <--- Dedicated HTTP port for DoH (Caddy proxies to this)
      path: /dns-query # Standard path for DoH
      # No TLS settings here, as Caddy handles TLS
